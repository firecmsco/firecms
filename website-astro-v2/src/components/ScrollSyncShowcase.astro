---
// ScrollSyncShowcase.astro
// A two-column scroll-sync section with a sticky index on the left
// Uses Tailwind classes available in the site. Pure placeholders.
---

<section id="scroll-sync-showcase" class="relative isolate bg-black py-24 sm:py-28 border-b border-gray-800">
  <div class="mx-auto max-w-7xl px-6 lg:px-8">
    <div class="flex gap-12 lg:gap-16">
      <!-- Left: Sticky index -->
      <aside class="hidden lg:block w-[300px] flex-shrink-0">
        <nav class="sticky top-28">
          <ol class="space-y-3">
            <li>
              <a href="#screen-1" data-index-item class="group block" data-active="false">
                <div class="flex items-center gap-3 pl-3 py-1 border-l border-transparent group-data-[active=true]:border-primary transition-colors">
                  <span class="text-lg md:text-xl text-gray-300 group-data-[active=true]:text-white group-data-[active=true]:font-semibold">Data Editing</span>
                </div>
                <div class="overflow-hidden transition-all duration-300 ease-out group-data-[active=false]:max-h-0 group-data-[active=true]:max-h-40">
                  <p class="text-sm text-gray-400 pl-3 pt-2 pb-1 opacity-0 group-data-[active=true]:opacity-100 transition-opacity duration-300 delay-75">Edit data as easily as a spreadsheet with powerful inline editing.</p>
                </div>
              </a>
            </li>
            <li>
              <a href="#screen-2" data-index-item class="group block" data-active="false">
                <div class="flex items-center gap-3 pl-3 py-1 border-l border-transparent group-data-[active=true]:border-primary transition-colors">
                  <span class="text-lg md:text-xl text-gray-300 group-data-[active=true]:text-white group-data-[active=true]:font-semibold">DataTalk</span>
                </div>
                <div class="overflow-hidden transition-all duration-300 ease-out group-data-[active=false]:max-h-0 group-data-[active=true]:max-h-40">
                  <p class="text-sm text-gray-400 pl-3 pt-2 pb-1 opacity-0 group-data-[active=true]:opacity-100 transition-opacity duration-300 delay-75">Query and update your data using natural language.</p>
                </div>
              </a>
            </li>
            <li>
              <a href="#screen-3" data-index-item class="group block" data-active="false">
                <div class="flex items-center gap-3 pl-3 py-1 border-l border-transparent group-data-[active=true]:border-primary transition-colors">
                  <span class="text-lg md:text-xl text-gray-300 group-data-[active=true]:text-white group-data-[active=true]:font-semibold">Schema Builder</span>
                </div>
                <div class="overflow-hidden transition-all duration-300 ease-out group-data-[active=false]:max-h-0 group-data-[active=true]:max-h-40">
                  <p class="text-sm text-gray-400 pl-3 pt-2 pb-1 opacity-0 group-data-[active=true]:opacity-100 transition-opacity duration-300 delay-75">Build your data models visually or infer from existing data.</p>
                </div>
              </a>
            </li>
            <li>
              <a href="#screen-4" data-index-item class="group block" data-active="false">
                <div class="flex items-center gap-3 pl-3 py-1 border-l border-transparent group-data-[active=true]:border-primary transition-colors">
                  <span class="text-lg md:text-xl text-gray-300 group-data-[active=true]:text-white group-data-[active=true]:font-semibold">Easy Integration</span>
                </div>
                <div class="overflow-hidden transition-all duration-300 ease-out group-data-[active=false]:max-h-0 group-data-[active=true]:max-h-40">
                  <p class="text-sm text-gray-400 pl-3 pt-2 pb-1 opacity-0 group-data-[active=true]:opacity-100 transition-opacity duration-300 delay-75">Get started in minutes with Cloud or self-hosted options.</p>
                </div>
              </a>
            </li>
          </ol>
        </nav>
      </aside>

      <!-- Right: Content area with fixed size (can overflow) -->
      <div class="flex-1 min-w-0">
        <div class="w-full lg:w-[1240px] space-y-32">
      <!-- Screen 1: Data Editing -->
      <section id="screen-1" data-screen class="scroll-mt-32 will-change-transform">
        <div class="mb-4 text-base md:text-lg font-semibold leading-6 text-teal-400">Data Management</div>
        <h3 class="text-3xl md:text-4xl font-semibold tracking-tight text-white mb-5">Edit Data as Easily as a Spreadsheet</h3>
        <p class="text-gray-400 mb-8">AirTable-like UI with powerful inline editing, sorting, and filtering</p>
        <div class="relative rounded-2xl p-[1px] bg-linear-to-br from-white/10 via-white/5 to-transparent">
          <div class="relative rounded-2xl overflow-hidden ring-1 ring-white/10 bg-gray-950">
            <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full bg-primary/10 blur-3xl"></div>
            <video
              class="w-full h-auto"
              style="pointer-events: none;"
              loop
              autoplay
              muted
              playsinline>
              <source src="/img/landing_1080.webm" type="video/webm"/>
            </video>
          </div>
        </div>
      </section>

      <!-- Screen 2: DataTalk -->
      <section id="screen-2" data-screen class="scroll-mt-32 will-change-transform">
        <div class="mb-4 text-base md:text-lg font-semibold leading-6 text-teal-400">Natural Language Queries</div>
        <h3 class="text-3xl md:text-4xl font-semibold tracking-tight text-white mb-5">Talk to Your Data</h3>
        <p class="text-gray-400 mb-8">Query, update, and manage your collections using simple, natural language</p>
        <div class="relative rounded-2xl p-[1px] bg-linear-to-br from-white/10 via-white/5 to-transparent">
          <div class="relative rounded-2xl overflow-hidden ring-1 ring-white/10 bg-gray-950">
            <div class="absolute -top-24 -right-24 h-72 w-72 rounded-full bg-primary/10 blur-3xl"></div>
            <img src="/img/widgets.png" alt="DataTalk - Talk to your data with AI" class="w-full h-auto" />
          </div>
        </div>
      </section>

      <!-- Screen 3: Schema Builder -->
      <section id="screen-3" data-screen class="scroll-mt-32 will-change-transform">
        <div class="mb-4 text-base md:text-lg font-semibold leading-6 text-teal-400">Visual Schema Builder</div>
        <h3 class="text-3xl md:text-4xl font-semibold tracking-tight text-white mb-5">Build Your Data Models, Your Way</h3>
        <p class="text-gray-400 mb-8">Automatic schema inference or visual builder with 20+ field types and advanced validation</p>
        <div class="relative rounded-2xl p-[1px] bg-linear-to-br from-white/10 via-white/5 to-transparent">
          <div class="relative rounded-2xl overflow-hidden ring-1 ring-white/10 bg-gray-950">
            <div class="absolute -top-28 -left-20 h-72 w-72 rounded-full bg-primary/10 blur-3xl"></div>
            <video
              class="w-full h-auto"
              style="pointer-events: none;"
              loop
              autoplay
              muted
              playsinline>
              <source src="/img/schema_editor.webm" type="video/webm"/>
            </video>
          </div>
        </div>
      </section>

      <!-- Screen 4: Easy Integration -->
      <section id="screen-4" data-screen class="scroll-mt-32 will-change-transform">
        <div class="mb-4 text-base md:text-lg font-semibold leading-6 text-teal-400">Developer Experience</div>
        <h3 class="text-3xl md:text-4xl font-semibold tracking-tight text-white mb-5">Easy Integration with Your Stack</h3>
        <p class="text-gray-400 mb-8">Managed Cloud solution or self-hosted with full TypeScript support</p>
        <div class="relative rounded-2xl p-[1px] bg-linear-to-br from-white/10 via-white/5 to-transparent">
          <div class="relative rounded-2xl overflow-hidden ring-1 ring-white/10 bg-gray-950">
            <div class="p-6 sm:p-8">
              <div class="space-y-6">
                <div class="flex items-start gap-4">
                  <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 ring-1 ring-primary/20 flex-shrink-0">
                    <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/code-2.svg" alt="" class="h-5 w-5 filter invert" />
                  </div>
                  <div>
                    <h4 class="text-lg font-semibold text-white mb-2">Simple NPM Install</h4>
                    <p class="text-gray-400 text-sm mb-3">Add FireCMS to your project with a single command</p>
                    <div class="bg-gray-900/50 rounded-lg p-4 font-mono text-sm text-gray-300">
                      npm install @firecms/core @firecms/firebase
                    </div>
                  </div>
                </div>
                <div class="flex items-start gap-4">
                  <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 ring-1 ring-primary/20 flex-shrink-0">
                    <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/rocket.svg" alt="" class="h-5 w-5 filter invert" />
                  </div>
                  <div>
                    <h4 class="text-lg font-semibold text-white mb-2">Or Use FireCMS Cloud</h4>
                    <p class="text-gray-400 text-sm">No setup required. Connect your Firebase project and start managing your data instantly with our managed platform.</p>
                  </div>
                </div>
                <div class="flex items-start gap-4">
                  <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-primary/10 ring-1 ring-primary/20 flex-shrink-0">
                    <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/zap.svg" alt="" class="h-5 w-5 filter invert" />
                  </div>
                  <div>
                    <h4 class="text-lg font-semibold text-white mb-2">Full TypeScript Support</h4>
                    <p class="text-gray-400 text-sm">Built with TypeScript from the ground up for the best developer experience and type safety.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
        </div>
      </div>
    </div>
  </div>

  <script>
    const root = document.getElementById('scroll-sync-showcase');
    const screens = (root?.querySelectorAll('[data-screen]') as NodeListOf<HTMLElement>) || null;
    const indexItems = (root?.querySelectorAll('[data-index-item]') as NodeListOf<HTMLAnchorElement>) || null;

    if (screens && indexItems) {
      const byId = new Map<string, HTMLAnchorElement>();
      indexItems.forEach((a) => {
        const id = a.getAttribute('href')?.replace('#', '') || '';
        if (id) byId.set(id, a);
        a.addEventListener('click', (e) => {
          e.preventDefault();
          const target = document.getElementById(id);
          if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
      });

      const activate = (id: string) => {
        indexItems.forEach((a) => a.setAttribute('data-active', 'false'));
        const el = byId.get(id);
        if (el) el.setAttribute('data-active', 'true');
      };

      // Keep IO for index activation only
      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) activate(entry.target.id);
          });
        },
        { rootMargin: '-30% 0px -50% 0px', threshold: [0.1, 0.25, 0.5] }
      );
      screens.forEach((s) => io.observe(s));

      // Scroll-bound animation
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const maxOffsetPx = 32; // slide distance
      const minOpacity = 0.25; // ensure minimum opacity is not 0 for subtlety

      const clamp = (v: number, min: number, max: number): number => Math.max(min, Math.min(max, v));

      const update = () => {
        const vh = window.innerHeight || 1;
        const start = vh * 0.2;
        const end = vh * 0.6;
        const span = Math.max(1, end - start);

        screens.forEach((s) => {
          const rect = s.getBoundingClientRect();
          if (prefersReduced) {
            s.style.opacity = '1';
            s.style.transform = 'translate3d(0,0,0)';
            return;
          }
          // progress 0..1 based on section top moving from start to end
          const p = clamp((end - rect.top) / span, 0, 1);
          const tx = (1 - p) * maxOffsetPx;
          const op = minOpacity + p * (1 - minOpacity);
          s.style.opacity = String(op);
          s.style.transform = `translate3d(${tx}px, 0, 0)`;
        });
      };

      let ticking = false;
      const requestTick = () => {
        if (ticking) return;
        ticking = true;
        requestAnimationFrame(() => {
          update();
          ticking = false;
        });
      };

      window.addEventListener('scroll', requestTick, { passive: true });
      window.addEventListener('resize', requestTick);
      // Initial paint
      requestTick();
    }
  </script>
</section>
