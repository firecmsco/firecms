---
// Cookie Banner Component
---

<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 z-[9999] hidden transition-all duration-300 ease-in-out opacity-0 translate-y-full">
  <div class="bg-gradient-to-r from-gray-950/98 to-gray-900/98 backdrop-blur-xl border-t border-gray-800 shadow-[0_-4px_20px_rgba(0,0,0,0.5)]">
    <div class="mx-auto max-w-7xl px-6 py-6 lg:px-8">
      <div class="flex flex-wrap items-center justify-between gap-6 lg:gap-8">
        <div class="flex-1 min-w-[300px]">
          <p class="text-sm leading-6 text-gray-300 lg:text-base">
            <strong class="font-semibold text-white">We use cookies</strong> to enhance your browsing experience and analyze our traffic.
            <br/>By clicking "Accept", you consent to our use of cookies.
            <a href="/policy/cookies_policy" class="ml-1 text-primary underline hover:text-primary-light transition-colors">Learn more</a>
          </p>
        </div>
        <div class="flex items-center gap-4 w-full sm:w-auto">
          <button
            id="cookie-decline"
            class="flex-1 sm:flex-none inline-flex items-center justify-center gap-x-2 rounded-md bg-gray-900/50 px-6 py-3 text-base font-semibold text-gray-400 hover:text-white hover:bg-gray-800 hover:border-gray-600 transition-all duration-200 ease-in-out">
            Decline
          </button>

            <button
                    id="cookie-accept"
                    class="flex-1 sm:flex-none inline-flex items-center justify-center gap-x-2 rounded-md bg-primary px-6 py-3 text-base font-semibold text-white shadow-sm hover:bg-primary-dark transition-all duration-200 ease-in-out btn-glow hover:-translate-y-0.5">
                Accept All Cookies
            </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function initializeCookieBanner() {
    // Check if user has already made a choice
    const cookieConsent = localStorage.getItem('cookie-consent');
    const banner = document.getElementById('cookie-banner');

    if (!banner) return;

    if (!cookieConsent) {
      // Show banner immediately
      banner.classList.remove('hidden');
      // Trigger reflow
      banner.offsetHeight;
      banner.classList.remove('opacity-0', 'translate-y-full');
    } else {
      // Ensure banner stays hidden if consent was already given
      banner.classList.add('hidden');
    }

    // Handle accept button
    const acceptBtn = document.getElementById('cookie-accept');
    if (acceptBtn) {
      // Remove any existing listeners by cloning the element
      const newAcceptBtn = acceptBtn.cloneNode(true);
      acceptBtn.parentNode?.replaceChild(newAcceptBtn, acceptBtn);

      newAcceptBtn.addEventListener('click', () => {
        localStorage.setItem('cookie-consent', 'accepted');
        if (banner) {
          banner.classList.add('opacity-0', 'translate-y-full');
          setTimeout(() => {
            banner.classList.add('hidden');
          }, 300);
        }
        // Enable Google Analytics tracking (Consent Mode v2)
        if (typeof (window as any).gtag !== 'undefined') {
          (window as any).gtag('consent', 'update', {
            'ad_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted',
            'analytics_storage': 'granted'
          });
        }
      });
    }

    // Handle decline button
    const declineBtn = document.getElementById('cookie-decline');
    if (declineBtn) {
      // Remove any existing listeners by cloning the element
      const newDeclineBtn = declineBtn.cloneNode(true);
      declineBtn.parentNode?.replaceChild(newDeclineBtn, declineBtn);

      newDeclineBtn.addEventListener('click', () => {
        localStorage.setItem('cookie-consent', 'declined');
        if (banner) {
          banner.classList.add('opacity-0', 'translate-y-full');
          setTimeout(() => {
            banner.classList.add('hidden');
          }, 300);
        }
        // Disable Google Analytics tracking (Consent Mode v2)
        if (typeof (window as any).gtag !== 'undefined') {
          (window as any).gtag('consent', 'update', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
          });
        }
      });
    }
  }

  // Initialize on first load
  initializeCookieBanner();

  // Re-initialize after Astro view transitions
  document.addEventListener('astro:page-load', initializeCookieBanner);
</script>


