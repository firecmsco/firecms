---
import MobileMenuToggle from "virtual:starlight/components/MobileMenuToggle";
import SiteFooter from "../../components/Footer.astro";

const { hasSidebar } = Astro.locals.starlightRoute;
---

<div class="page">
    <!-- FIXED HEADER -->
    <header class="header">
        <slot name="header"/>
    </header>

    <!-- CONTENT AREA (sidebar + main) -->
    <div class="content-container">
        <!-- STICKY SIDEBAR -->
        {hasSidebar && (
            <aside class="sidebar-wrapper">
                <nav class="sidebar-sticky" aria-label={Astro.locals.t("sidebarNav.accessibleLabel")}>
                    <MobileMenuToggle/>
                    <div id="starlight__sidebar" class="sidebar-pane">
                        <div class="sidebar-content">
                            <slot name="sidebar"/>
                        </div>
                    </div>
                </nav>
            </aside>
        )}

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <slot/>
        </main>
    </div>

    <!-- FOOTER BELOW EVERYTHING -->
    <footer class="footer z-50">
        <SiteFooter/>
    </footer>
</div>

<style>
    .page {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    /* Fixed header at top */
    .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: var(--sl-nav-height);
        z-index: var(--sl-z-index-navbar);
        background-color: var(--sl-color-bg-nav);
        border-bottom: 1px solid var(--sl-color-hairline-shade);
        padding: var(--sl-nav-pad-y) var(--sl-nav-pad-x);
    }

    /* Content container with sidebar and main */
    .content-container {
        display: flex;
        margin-top: var(--sl-nav-height);
        flex: 1;
    }

    /* Sidebar wrapper - fixed width */
    .sidebar-wrapper {
        width: var(--sl-sidebar-width);
        flex-shrink: 0;
    }

    /* Sidebar sticky container */
    .sidebar-sticky {
        position: sticky;
        top: var(--sl-nav-height);
        height: calc(100vh - var(--sl-nav-height));
        overflow-y: auto; /* Scroll independently */
        background-color: var(--sl-color-bg-sidebar);
        border-right: 1px solid var(--sl-color-hairline-shade);
    }

    .sidebar-pane {
        height: 100%;
    }

    .sidebar-content {
        height: 100%;
        min-height: max-content;
        padding: 1rem var(--sl-sidebar-pad-x) 0;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .sidebar-content::after {
        content: '';
        padding-bottom: 1px;
    }

    /* Main content takes remaining space */
    .main-content {
        flex: 1;
        min-width: 0; /* Prevent flex overflow */
    }

    /* Footer at bottom */
    .footer {
        /* Footer styling handled by SiteFooter component */
    }

    /* Mobile: sidebar becomes overlay menu */
    @media (max-width: 50rem) {
        .content-container {
            flex-direction: column;
        }

        .sidebar-wrapper {
            width: 100%;
        }

        .sidebar-sticky {
            position: fixed;
            top: var(--sl-nav-height);
            left: 0;
            right: 0;
            bottom: 0;
            z-index: var(--sl-z-index-menu);
            background-color: var(--sl-color-black);
            visibility: var(--sl-sidebar-visibility, hidden);
        }

        :global([aria-expanded='true']) ~ .sidebar-pane {
            --sl-sidebar-visibility: visible;
        }

        .header {
            padding-inline-end: calc(
                var(--sl-nav-gap) + var(--sl-nav-pad-x) + var(--sl-menu-button-size)
            );
        }
    }

    @media (min-width: 50rem) {
        :global([data-has-sidebar]) .header {
            padding-inline-end: var(--sl-nav-pad-x);
        }
    }
</style>
